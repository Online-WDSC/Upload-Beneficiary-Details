<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">

<title>Beneficiary Entry</title>

<link rel="stylesheet"
 href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">

<style>
:root{
  --primary:#1f4e79;
  --secondary:#2563eb;
  --accent:#0ea5e9;
  --card:#ffffff;
  --border:#c7d2fe;
}
body{
  font-family:"Segoe UI", Arial;
  background:linear-gradient(120deg,#e0ecff,#f6f9ff);
  min-height:100vh;
  margin:0;
  padding:0;
}
.box{
  max-width:540px;
  margin:50px auto;
  background:var(--card);
  padding:26px;
  border-radius:16px;
  box-shadow:0 15px 40px rgba(0,0,0,.12);
}
.box::before{
  content:"";
  display:block;
  height:6px;
  background:linear-gradient(90deg,var(--primary),var(--secondary),var(--accent));
  margin:-26px -26px 20px;
}
h2{
  text-align:center;
  color:var(--primary);
  display:flex;
  justify-content:center;
  gap:10px;
}
label{
  font-size:13px;
  font-weight:600;
  margin-top:12px;
  display:block;
}
input,select{
  width:100%;
  padding:11px;
  margin:6px 0;
  border-radius:9px;
  border:1px solid var(--border);
  background:#f9fbff;
}
button{
  width:100%;
  padding:12px;
  margin-top:16px;
  border-radius:10px;
  background:var(--secondary);
  color:#fff;
  font-weight:600;
  border:none;
  cursor:pointer;
}
.success{
  margin-top:14px;
  font-size:14px;
  font-weight:600;
  text-align:center;
  color:#065f46;
  background:#ecfdf5;
  border:1px solid #bbf7d0;
  padding:8px;
  border-radius:8px;
}
</style>
</head>

<body>
<div class="box">

<h2><i class="fa-solid fa-people-group"></i> Upload Beneficiary Details</h2>

<label><i class="fa-solid fa-magnifying-glass"></i> Search Work</label>
<input type="text" id="workSearch" placeholder="Type to filter work list">

<label><i class="fa-solid fa-list-check"></i> Select Work</label>
<select id="workName">
  <option value="">Loading works…</option>
</select>

<label>Beneficiary ID Type</label>
<select id="beneficiaryType">
  <option>Ration Card</option>
  <option>Bhamashah / Janaadhar</option>
</select>

<label>ID Number</label>
<input type="text" id="idNumber">

<label>Beneficiary Name</label>
<input type="text" id="beneficiaryName">

<label>Category</label>
<select id="category">
  <option>SC</option>
  <option>ST</option>
  <option>OBC</option>
  <option>General</option>
  <option>Other</option>
</select>

<label>ID Photo – Front</label>
<input type="file" accept="image/*" onchange="readFront(this)">

<label>ID Photo – Back</label>
<input type="file" accept="image/*" onchange="readBack(this)">

<label>Upload PDF</label>
<input type="file" accept="application/pdf" onchange="readPdf(this)">

<button onclick="submitForm()">
  <i class="fa-solid fa-cloud-arrow-up"></i> Save Entry
</button>

<div class="success" id="msg"></div>

</div>

<script>
/* ===== CONFIG ===== */
const API_URL =
"https://script.google.com/macros/s/AKfycbySfRHPqB5sY_N4QeLyfXffGaHJQcpT-2iHU03wapC6fpSKTt5AQWthe7ArdQr-DReZgQ/exec";

/* ===== STATE ===== */
let frontPhoto=null, backPhoto=null, pdfFile=null;
let allWorks=[];

const workSearch=document.getElementById("workSearch");
const workSelect=document.getElementById("workName");
const msg=document.getElementById("msg");

/* ===== LOAD WORK LIST ===== */
fetch(API_URL+"?api=1&action=getWorks")
.then(r=>r.json())
.then(list=>{
  allWorks=list || [];
  render(allWorks);
})
.catch(()=>workSelect.innerHTML='<option>Error loading</option>');

function render(arr){
  workSelect.innerHTML='<option value="">-- Select Work --</option>';
  arr.forEach(w=>{
    const o=document.createElement("option");
    o.value=w; o.textContent=w;
    workSelect.appendChild(o);
  });
}

/* ===== SEARCH ===== */
workSearch.oninput=()=>{
  const q=workSearch.value.toLowerCase();
  render(allWorks.filter(w=>w.toLowerCase().includes(q)));
};

/* ===== FILE READERS ===== */
function readFront(i){read(i,v=>frontPhoto=v);}
function readBack(i){read(i,v=>backPhoto=v);}
function readPdf(i){read(i,v=>pdfFile=v);}
function read(i,cb){
  if(!i.files[0])return;
  const r=new FileReader();
  r.onload=e=>cb(e.target.result.split(",")[1]);
  r.readAsDataURL(i.files[0]);
}

/* ===== SUBMIT ===== */
function submitForm(){
  if(!workSelect.value||!idNumber.value){
    alert("Required fields missing");
    return;
  }
  msg.innerText="Uploading…";

 fetch(API_URL,{
  method:"POST",
  headers:{ "Content-Type":"application/json" },
  body: JSON.stringify({ test:"ok" })
})
.then(r=>r.text())
.then(alert)
.catch(err=>alert("ERROR"));

</script>
</body>
</html>

